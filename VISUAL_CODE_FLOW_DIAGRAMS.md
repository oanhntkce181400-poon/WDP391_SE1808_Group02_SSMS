# ğŸ¨ Visual Code Flow - ViewProfile & UpdateProfile

## ğŸ”„ Complete Request/Response Cycle

### CYCLE 1: Load Profile (First Time)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. COMPONENT MOUNTS (useEffect runs)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ fetchProfile()  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ setLoading(true)              â”‚
     â”‚ setError(null)                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ userService.getProfile()     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ axiosClient.get(              â”‚
    â”‚   '/users/profile',           â”‚
    â”‚   { headers: JWT token }      â”‚
    â”‚ )                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ HTTP Request        â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
        â”‚ Method: GET         â”‚
        â”‚ URL: /users/profile â”‚
        â”‚ Auth: Bearer ...    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ BACKEND PROCESSING              â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
        â”‚ 1. authMiddleware               â”‚
        â”‚    â””â”€ Validate JWT token        â”‚
        â”‚    â””â”€ Extract userId            â”‚
        â”‚                                 â”‚
        â”‚ 2. getUserProfile()             â”‚
        â”‚    â”œâ”€ User.findById(userId)    â”‚
        â”‚    â”œâ”€ .select('-password')     â”‚
        â”‚    â”œâ”€ Check if user exists     â”‚
        â”‚    â””â”€ Return user object       â”‚
        â”‚                                 â”‚
        â”‚ 3. Return Response              â”‚
        â”‚    {                            â”‚
        â”‚      success: true,             â”‚
        â”‚      data: { ... user ... }     â”‚
        â”‚    }                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ HTTP Response       â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
        â”‚ Status: 200 OK      â”‚
        â”‚ Body: User data     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Service returns response     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Frontend handles response     â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚ const data = response.data   â”‚
    â”‚                              â”‚
    â”‚ setStudent(data)             â”‚
    â”‚ â”œâ”€ _id, fullName, email,    â”‚
    â”‚ â”œâ”€ avatarUrl, role,         â”‚
    â”‚ â”œâ”€ status, createdAt, ...   â”‚
    â”‚ â”‚                            â”‚
    â”‚ setEditFormData({            â”‚
    â”‚   fullName: data.fullName,   â”‚
    â”‚   email: data.email          â”‚
    â”‚ })                           â”‚
    â”‚                              â”‚
    â”‚ setLoading(false)            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Component Re-  â”‚
            â”‚ render with    â”‚
            â”‚ user data      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Display:               â”‚
            â”‚ - Avatar              â”‚
            â”‚ - Full name           â”‚
            â”‚ - Email               â”‚
            â”‚ - Edit button         â”‚
            â”‚ - Courses list        â”‚
            â”‚ - GPA info            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### CYCLE 2: Edit & Save Profile

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER INTERACTION                                            â”‚
â”‚    - Click "Chá»‰nh sá»­a há»“ sÆ¡" button                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         setIsEditing(true)
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Show Edit Form              â”‚
        â”‚ - fullName input field      â”‚
        â”‚ - email input field         â”‚
        â”‚ - Save button               â”‚
        â”‚ - Cancel button             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ USER TYPES INPUT            â”‚
        â”‚ - Clears fullName           â”‚
        â”‚ - Types: "Nguyá»…n VÄƒn B"    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         handleEditChange({
           target: { name, value }
         })
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ setEditFormData(prev => ({           â”‚
        â”‚   ...prev,                           â”‚
        â”‚   [name]: value  // Update field     â”‚
        â”‚ }))                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Form input updates in real-time     â”‚
        â”‚ input.value = "Nguyá»…n VÄƒn B"       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ USER CLICKS "LÆ¯U THAY Äá»”I"         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         handleSaveProfile()
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ setIsSaving(true)â”‚ â†’ Button disabled
         â”‚ setError(null)   â”‚ â†’ Clear old errors
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ userService.updateProfile({  â”‚
    â”‚   fullName: "...",           â”‚
    â”‚   email: "..."               â”‚
    â”‚ })                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ axiosClient.patch(           â”‚
    â”‚   '/users/profile',          â”‚
    â”‚   data,                      â”‚
    â”‚   { headers: JWT token }     â”‚
    â”‚ )                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ HTTP Request        â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
        â”‚ Method: PATCH       â”‚
        â”‚ URL: /users/profile â”‚
        â”‚ Auth: Bearer ...    â”‚
        â”‚ Body: {             â”‚
        â”‚   fullName: "...",  â”‚
        â”‚   email: "..."      â”‚
        â”‚ }                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ BACKEND PROCESSING              â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
        â”‚ 1. authMiddleware               â”‚
        â”‚    â””â”€ Validate JWT token        â”‚
        â”‚                                 â”‚
        â”‚ 2. updateProfile()              â”‚
        â”‚    â”œâ”€ Extract userId from token â”‚
        â”‚    â”œâ”€ User.findById(userId)    â”‚
        â”‚    â”œâ”€ Check if user exists     â”‚
        â”‚    â”œâ”€ user.fullName = newName  â”‚
        â”‚    â”œâ”€ If email changed:        â”‚
        â”‚    â”‚  â”œâ”€ Check duplicate       â”‚
        â”‚    â”‚  â”œâ”€ Return 400 if exists  â”‚
        â”‚    â”‚  â””â”€ user.email = newEmail â”‚
        â”‚    â”œâ”€ user.updatedBy = userId  â”‚
        â”‚    â”œâ”€ await user.save()        â”‚
        â”‚    â””â”€ Return updated user      â”‚
        â”‚                                 â”‚
        â”‚ 3. Return Response              â”‚
        â”‚    {                            â”‚
        â”‚      success: true,             â”‚
        â”‚      message: "Updated",        â”‚
        â”‚      data: { ... user ... }     â”‚
        â”‚    }                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ HTTP Response       â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
        â”‚ Status: 200 OK      â”‚
        â”‚ Body: Updated user  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Frontend handles response    â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚ if (success) {               â”‚
    â”‚   setStudent(newData)        â”‚
    â”‚   setIsEditing(false)        â”‚
    â”‚   setSuccessMessage(         â”‚
    â”‚     "ThÃ nh cÃ´ng!"            â”‚
    â”‚   )                          â”‚
    â”‚   setTimeout(..., 3000)      â”‚
    â”‚ } else {                     â”‚
    â”‚   setError(message)          â”‚
    â”‚ }                            â”‚
    â”‚                              â”‚
    â”‚ setIsSaving(false)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Component Re-render      â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚ Exit edit mode           â”‚
    â”‚ Display new data         â”‚
    â”‚ Show success toast       â”‚
    â”‚ (auto-hide after 3s)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### CYCLE 3: Upload Avatar

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER INTERACTION (AvatarUploader.jsx)                      â”‚
â”‚    - Click edit button on avatar                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Open file pickerâ”‚
        â”‚ accept="image/*"â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User selects image file     â”‚
        â”‚ e.g., avatar.jpg            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         onChange={handleFileSelect}
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ handleFileSelect(event)     â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚ file = event.target.        â”‚
        â”‚        files[0]             â”‚
        â”‚                             â”‚
        â”‚ new FileReader()            â”‚
        â”‚ reader.onload = (e) => {    â”‚
        â”‚   setCropImage({            â”‚
        â”‚     src: e.target.result,   â”‚
        â”‚     file: file              â”‚
        â”‚   })                        â”‚
        â”‚   setShowCropDialog(true)   â”‚
        â”‚ }                           â”‚
        â”‚ reader.readAsDataURL(file)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ SHOW CROP DIALOG            â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚ Display image preview       â”‚
        â”‚ Canvas for crop             â”‚
        â”‚ Crop controls               â”‚
        â”‚ Confirm/Cancel buttons      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User confirms crop          â”‚
        â”‚ Click "Crop & Upload"       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         handleCropConfirm()
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ canvas.toBlob((blob) => {        â”‚
        â”‚   croppedFile = new File(        â”‚
        â”‚     [blob],                      â”‚
        â”‚     'avatar.webp'                â”‚
        â”‚   )                              â”‚
        â”‚   uploadAvatar(croppedFile)      â”‚
        â”‚ })                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ uploadAvatar(file)           â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚ setIsUploading(true)         â”‚
    â”‚ setUploadProgress(0)         â”‚
    â”‚                              â”‚
    â”‚ userService.updateAvatar(    â”‚
    â”‚   file,                      â”‚
    â”‚   onUploadProgress           â”‚
    â”‚ )                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ userService.updateAvatar()   â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚ const formData =             â”‚
    â”‚   new FormData()             â”‚
    â”‚ formData.append(             â”‚
    â”‚   'avatar', file             â”‚
    â”‚ )                            â”‚
    â”‚                              â”‚
    â”‚ axiosClient.patch(           â”‚
    â”‚   '/users/avatar',           â”‚
    â”‚   formData,                  â”‚
    â”‚   {                          â”‚
    â”‚     headers: {               â”‚
    â”‚       'Content-Type':        â”‚
    â”‚       'multipart/form-data'  â”‚
    â”‚     },                       â”‚
    â”‚     onUploadProgress         â”‚
    â”‚   }                          â”‚
    â”‚ )                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ HTTP Request        â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
        â”‚ Method: PATCH       â”‚
        â”‚ URL: /users/avatar  â”‚
        â”‚ Auth: Bearer ...    â”‚
        â”‚ Body: FormData {    â”‚
        â”‚   avatar: <File>    â”‚
        â”‚ }                   â”‚
        â”‚                     â”‚
        â”‚ UPLOAD PROGRESS:    â”‚
        â”‚ 0% â†’ 25% â†’ 50% â†’    â”‚
        â”‚ 75% â†’ 100%          â”‚
        â”‚ (via onUploadProgress)
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ BACKEND PROCESSING              â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
        â”‚ 1. avatarUpload.middleware      â”‚
        â”‚    â””â”€ Multer parses file       â”‚
        â”‚    â””â”€ Sets req.file            â”‚
        â”‚                                 â”‚
        â”‚ 2. authMiddleware               â”‚
        â”‚    â””â”€ Validate JWT token        â”‚
        â”‚                                 â”‚
        â”‚ 3. updateAvatar()               â”‚
        â”‚    â”œâ”€ Check file exists        â”‚
        â”‚    â”œâ”€ User.findById(userId)    â”‚
        â”‚    â”œâ”€ Delete old avatar from   â”‚
        â”‚    â”‚  Cloudinary (if exists)   â”‚
        â”‚    â”œâ”€ uploadImage(             â”‚
        â”‚    â”‚   req.file.buffer,        â”‚
        â”‚    â”‚   options: {              â”‚
        â”‚    â”‚     folder: 'ssms/...',   â”‚
        â”‚    â”‚     format: 'webp',       â”‚
        â”‚    â”‚     quality: 'auto',      â”‚
        â”‚    â”‚     width: 400,           â”‚
        â”‚    â”‚     height: 400,          â”‚
        â”‚    â”‚     crop: 'fill'          â”‚
        â”‚    â”‚   }                       â”‚
        â”‚    â”‚ )                         â”‚
        â”‚    â”œâ”€ Cloudinary returns:      â”‚
        â”‚    â”‚  {                        â”‚
        â”‚    â”‚    secure_url: "...",     â”‚
        â”‚    â”‚    public_id: "..."       â”‚
        â”‚    â”‚  }                        â”‚
        â”‚    â”œâ”€ user.avatarUrl =        â”‚
        â”‚    â”‚  secure_url              â”‚
        â”‚    â”œâ”€ user.avatarCloudinaryId â”‚
        â”‚    â”‚  = public_id             â”‚
        â”‚    â”œâ”€ await user.save()       â”‚
        â”‚    â””â”€ Return response         â”‚
        â”‚                                 â”‚
        â”‚ 4. Return Response              â”‚
        â”‚    {                            â”‚
        â”‚      success: true,             â”‚
        â”‚      message: "Avatar...",      â”‚
        â”‚      data: {                    â”‚
        â”‚        avatarUrl: "..."         â”‚
        â”‚      }                          â”‚
        â”‚    }                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ HTTP Response       â”‚
        â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
        â”‚ Status: 200 OK      â”‚
        â”‚ Body: Avatar URL    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ onUploadProgress: 100%       â”‚
    â”‚                              â”‚
    â”‚ Frontend handles response    â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚ setUploadProgress(100)       â”‚
    â”‚ setIsUploading(false)        â”‚
    â”‚ setUploadProgress(0)         â”‚
    â”‚                              â”‚
    â”‚ onUploadSuccess()            â”‚
    â”‚ â”œâ”€ setSuccessMessage(        â”‚
    â”‚ â”‚   "Avatar updated!"        â”‚
    â”‚ â”‚ )                          â”‚
    â”‚ â”œâ”€ setTimeout(..., 3000)     â”‚
    â”‚ â””â”€ fetchStudentProfile()     â”‚
    â”‚    (Reload profile data)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Component Re-render           â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚ Display new avatar image      â”‚
    â”‚ Show success toast message    â”‚
    â”‚ (auto-hide after 3s)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Database Model

```javascript
// User Model
{
  _id: ObjectId,                 // Auto-generated ID
  
  // Personal Info
  fullName: String,              // "Nguyá»…n VÄƒn An"
  email: String,                 // "student@example.com"
  password: String,              // Hashed (NOT sent in response)
  
  // Avatar
  avatarUrl: String,             // "https://res.cloudinary.com/..."
  avatarCloudinaryId: String,    // "ssms/avatars/xyz123"
  
  // Role & Status
  role: String,                  // "student" | "staff" | "admin"
  status: String,                // "active" | "inactive" | "suspended"
  
  // Timestamps
  createdAt: Date,               // "2024-01-28T10:20:00Z"
  updatedAt: Date,               // "2024-01-28T15:30:00Z"
  updatedBy: ObjectId,           // User who updated this record
  
  // Other fields...
  studentId: String,
  majorId: ObjectId,
  // ... etc
}

// After SELECT '-password':
{
  _id, fullName, email, avatarUrl, avatarCloudinaryId,
  role, status, createdAt, updatedAt, updatedBy, ...
  // password field is EXCLUDED
}
```

---

## ğŸ“Š State Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Initial State (Component Mount)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ student: null                                               â”‚
â”‚ isEditing: false                                            â”‚
â”‚ editFormData: { fullName: '', email: '' }                 â”‚
â”‚ loading: true                                               â”‚
â”‚ error: null                                                 â”‚
â”‚ successMessage: ''                                          â”‚
â”‚ isSaving: false                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        [fetchStudentProfile called]
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Loading State (API Call In Progress)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ student: null                                               â”‚
â”‚ loading: true          â† Show spinner                       â”‚
â”‚ error: null                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        [API Response Received]
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Loaded State (Profile Data Available)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ student: {                                                  â”‚
â”‚   _id: "507f...",                                           â”‚
â”‚   fullName: "Nguyá»…n VÄƒn An",                               â”‚
â”‚   email: "student@example.com",                             â”‚
â”‚   avatarUrl: "https://...",                                â”‚
â”‚   ...                                                       â”‚
â”‚ }                                                           â”‚
â”‚ editFormData: {                                             â”‚
â”‚   fullName: "Nguyá»…n VÄƒn An",                               â”‚
â”‚   email: "student@example.com"                              â”‚
â”‚ }                                                           â”‚
â”‚ loading: false         â† Hide spinner                       â”‚
â”‚ error: null                                                 â”‚
â”‚ isEditing: false       â† Show view mode                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
         [User clicks "Chá»‰nh sá»­a"]
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edit Mode State                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ student: { ... same ... }                                   â”‚
â”‚ isEditing: true        â† Show edit form                     â”‚
â”‚ editFormData: {                                             â”‚
â”‚   fullName: "Nguyá»…n VÄƒn An",                               â”‚
â”‚   email: "student@example.com"                              â”‚
â”‚ }                                                           â”‚
â”‚ isSaving: false                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        [User changes fullName and clicks Save]
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Saving State                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ editFormData: {                                             â”‚
â”‚   fullName: "Nguyá»…n VÄƒn B",  â† Changed by user             â”‚
â”‚   email: "student@example.com"                              â”‚
â”‚ }                                                           â”‚
â”‚ isSaving: true         â† Button disabled                    â”‚
â”‚ isEditing: true                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        [API Response - Update Successful]
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Saved State                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ student: {                                                  â”‚
â”‚   ...                                                       â”‚
â”‚   fullName: "Nguyá»…n VÄƒn B",  â† Updated                     â”‚
â”‚   ...                                                       â”‚
â”‚ }                                                           â”‚
â”‚ editFormData: { ... same ... }                              â”‚
â”‚ isEditing: false       â† Back to view mode                  â”‚
â”‚ isSaving: false        â† Button enabled                     â”‚
â”‚ successMessage: "ThÃ nh cÃ´ng!" â† Show toast                 â”‚
â”‚                                                             â”‚
â”‚ [After 3 seconds]                                           â”‚
â”‚ successMessage: ''     â† Hide toast                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Error Scenarios

### Scenario 1: Network Error

```
fetchStudentProfile()
    â†“
API Call Fails (Network Error)
    â†“
catch (err) {
  setError('KhÃ´ng thá»ƒ táº£i...: Network Error')
  console.error(err)
}
    â†“
Display Red Error Box
"âœ— KhÃ´ng thá»ƒ táº£i...: Network Error"
    â†“
User clicks "Thá»­ láº¡i" â†’ Retry
```

### Scenario 2: Email Already In Use

```
handleSaveProfile()
    â†“
updateProfile({ 
  fullName: "...",
  email: "existing@example.com"  â† Already used by another user
})
    â†“
Backend Check:
const existingUser = await User.findOne({ email })
if (existingUser) {
  return res.status(400).json({
    success: false,
    message: 'Email already in use'
  })
}
    â†“
Frontend Catches Error:
catch (err) {
  setError('Email already in use')
}
    â†“
Display Error Message
"âœ— Email already in use"
    â†“
Form stays in edit mode
User can modify and retry
```

### Scenario 3: File Upload Failed

```
uploadAvatar(file)
    â†“
HTTP Upload Fails
    â†“
catch (err) {
  setIsUploading(false)
  setUploadProgress(0)
  alert('Upload failed: ' + err.message)
}
    â†“
User can retry
```

---

## ğŸ¯ Summary Table

| Event | State Change | UI Update |
|-------|-------------|-----------|
| Component mount | loading: true | Show spinner |
| API response | loading: false, student: data | Display profile |
| User clicks edit | isEditing: true | Show form |
| User types | editFormData: updated | Update input |
| User clicks save | isSaving: true | Disable button |
| Save successful | isEditing: false, successMessage: '...' | Show toast |
| Save failed | error: '...' | Show error |
| Upload progress | uploadProgress: 0-100 | Progress bar |
| Upload done | uploadProgress: 0, student: newData | Show avatar |

---

**Visual Diagram Created**: 29/01/2026  
**Version**: 1.0.0
